#<-- Setting script's external arguments
# Example run: sh extract.sh -i /var/tmp/
while getopts ":i:" opt; do
  case $opt in
    i) input_dir="$OPTARG"
    ;;
    \?) echo "Invalid option -$OPTARG" >&2
    ;;
  esac
done
#-->

#<-- Extract table data from files containing {studentId, grade, semester}
# Foreach file in the input dicectory ending with '_'
for file in ${input_dir}*
do
	# Extract data using regex and perform some cleansing.
	grep -oP "<?xml(.*)</DIV>" $file | grep -oP "\">?(.*?)</" | awk '{print $2 $3}' | grep -oP ">(.*?)<" | sed 's/[<>]//g' | awk -v RS="" '{print $1, $2, $3}' > temp
	
	cat data.txt | sed "s/ΦΕΒΡ/February/g" | sed "s/ΙΟΥΝ/June/g" | sed "s/ΣΕΠΤ/September/g" > temp_

	# Skip some empty lines in the beginning of the extracted file.
	tail temp_ -n +5 > ${file}_data.txt	
	# Remove the temporary file used to clean empty lines.
	rm -f temp*.txt
done
#-->

# Create a directory to store the extracted data.
DIR=${input_dir}"grades/"
mkdir ${DIR}

mv ${input_dir}*_data.txt ${DIR}
